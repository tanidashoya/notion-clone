//ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
//Supabase ã‚’ä½¿ã£ãŸã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼‰å‡¦ç†
import { supabase } from "../../lib/supabase";


//å‘¼ã³å‡ºã—å…ƒã‹ã‚‰æ¸¡ã•ã‚ŒãŸ3ã¤ã®å€¤(name,email,password)ã‚’ä½¿ã†ã€‚
//Supabaseã®auth.signUp()ãƒ¡ã‚½ãƒƒãƒ‰ã«ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»åå‰ã‚’æ¸¡ã™ã€‚
//çµæœãŒè¿”ã£ã¦ãã‚‹ã¨ã€data ã«æˆåŠŸæ™‚ã®æƒ…å ±ã€error ã«å¤±æ•—æ™‚ã®æƒ…å ±ãŒå…¥ã‚‹
export const authRepository = {
    async signUp(name: string, email: string, password: string) {
        const {data, error} = await supabase.auth.signUp({
            email,
            password,
            options: {data: {name},},
        });

        //ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        //ã‚¨ãƒ©ãƒ¼ãŒnullã§ãªã„ã€ã¾ãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒnullã§ã‚ã‚‹å ´åˆã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹
        //throwã¯ ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        //å‘¼ã³å‡ºã—å…ƒã«ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ â†’ å‘¼ã³å‡ºã—ã‚‚ã¨ã§ã‚¨ãƒ©ãƒ¼ã‚’try-catchã—ã¦å‡¦ç†ã™ã‚‹
        //new Error(error?.message)â‡’ã“ã®æ–°ã—ãç”Ÿæˆã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå‘¼ã³å‡ºã—å…ƒã®catchãƒ–ãƒ­ãƒƒã‚¯ã«eã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
        if (error !== null || data.user === null) {
            throw new Error(error?.message);
        }

        //data.user ã¯ Supabase ã® signUp() ãŒè¿”ã™ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        //data.user ã«ã¯ SupabaseãŒæ–°è¦ç™»éŒ²æ™‚ã«ä½œã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¦ã€
        // ãã®ä¸­ã«ã€Œæ¸¡ã—ãŸ emailã€ã¨ã€Œæ¸¡ã—ãŸ nameï¼ˆmetadataçµŒç”±ï¼‰ã€ã¯å…¥ã£ã¦ã„ã¾ã™ãŒã€password ã¯å«ã¾ã‚Œã¦ã„ãªã„ã€‚
        //å®Ÿéš›ã® data.user ã®ä¾‹
        // ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç›´å¾Œã® data.user ã¯ä¾‹ãˆã°ã“ã‚“ãªå½¢ã«ãªã‚Šã¾ã™ğŸ‘‡
        // {
        //   id: "uuid-xxxx",                       // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
        //   email: "test@example.com",              // â† æ¸¡ã—ãŸ email
        //   user_metadata: { name: "Taro" },        // â† æ¸¡ã—ãŸ name
        //   created_at: "2025-08-10T12:34:56Z",    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæ—¥æ™‚(ä»Šå›ã¯æ¸¡ã—ã¦ã„ãªã„ã®ã§å…¥ã£ã¦ã„ãªã„)
        //   ãƒ»
        //   ãƒ»
        //   ãƒ»
        // }

        //...data.user â†’ å…ƒã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã¦ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ®‹ã™
        // userName â†’ user_metadata.name ã®å€¤ã‚’ç›´æ¥å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã€æ–°ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦è¿½åŠ 
        return {
            ...data.user,
            userName:data.user.user_metadata.name,
        }
    },
}


/*
ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
function divide(a: number, b: number) {
  if (b === 0) {
    throw new Error("0ã§å‰²ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“");
  }
  return a / b;
}

try {
  console.log(divide(10, 0));
} catch (e) {
  console.error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:", e);
}
b ãŒ 0 ã®ã¨ãã« throw ã§ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿ

try å†…ã®å‡¦ç†ã¯ãã“ã§ä¸­æ–­ã•ã‚Œã€catch ã«å‡¦ç†ãŒç§»ã‚‹
*/
